## Side Markdown

A lightweight desktop **text/Markdown editor** with **multi-tabs**, **live split-view preview**, native-feeling **menus & shortcuts**, and robust **text encoding** support (UTF-8 / UTF-16LE / GBK / GB18030 / ANSI Win-1252). Built with Electron for **Windows** and **macOS**.

### Overview

- **Writing-first editing**: multi-tab workflow, undo/redo, word wrap, status bar, font settings, and insert date/time.
- **Live Markdown preview**: switch between edit/preview/split modes, syntax highlighting, and synced scrolling between editor and preview.
- **Fast navigation**: find/replace and go-to-line for long documents and quick fixes.
- **File & tab management**: new/open (supports multi-select), save/save as, and close tabs.
- **Better encoding compatibility**: built-in detection plus decode/encode helps handle common Chinese/Windows text files reliably.
- **Cross-platform consistency**: consistent menu structure and shortcut habits across Windows/macOS.
- **Built-in auto update (v1.1.0+)**: checks GitHub Releases and installs updates in-app (Windows requires the NSIS installer build).

### Release notes (v1.1.0)

- Added automatic in-app updates via GitHub Releases (electron-updater).
- Fixed preview scroll not following editor scroll.

### Tech stack

- **Renderer**: React 18 + TypeScript + Vite
- **Main/Preload**: Electron + tsup (compiled into `dist-electron/`)
- **Markdown**: `marked` + `highlight.js` + `dompurify` (safe HTML sanitization)
- **Encoding**: `chardet` (detection) + `iconv-lite` (decode/encode)
- **Packaging**: electron-builder (Win: nsis + portable; macOS: dmg + zip)

### Project structure

- `electron/main.ts`: main process (window, menus, IPC, file I/O)
- `electron/preload.ts`: preload script (`contextBridge` exposes a safe API)
- `src/`: React renderer (multi-tab editor, Markdown preview, status bar, etc.)

### Development

1) Install dependencies

```bash
npm i
```

2) Start dev mode (Vite + tsup watch + Electron)

```bash
npm run dev
```

### Analytics (build-time env)

Analytics is configured via **Vite build-time env** (renderer). Create `.env.local` and restart dev server / rebuild.
You can start from `env.sample` (copy to `.env.local`).

- **VITE_ANALYTICS_ENABLED**: `true` / `false` (default: `true`)
- **VITE_ANALYTICS_REGION**: `auto` / `cn` / `non-cn` (default: `auto`)
  - `auto`: determine CN/non-CN **by OS timezone only** (e.g. `Asia/Shanghai` => CN)
- **VITE_ANALYTICS_PROVIDER**: `auto` / `baidu` / `ga` / `both` (default: `auto`)
- **VITE_ANALYTICS_DEBUG**: `true` / `false` (default: `false`)
- **VITE_BAIDU_SITE_ID**: Baidu Tongji site id (optional)
- **VITE_GA_MEASUREMENT_ID**: GA measurement id like `G-XXXXXXX` (optional)

Notes:
- When region is inferred as **CN**, the app will pick **Baidu first** (if `VITE_BAIDU_SITE_ID` is set). Google is only used when region is **non-CN**, or when Baidu id is empty.
- To force Google analytics, set **`VITE_ANALYTICS_REGION=non-cn`** and provide a valid **`VITE_GA_MEASUREMENT_ID`**.
- In some networks (e.g. mainland China), `googletagmanager.com` may be blocked, causing GA script injection to fail.

### Build & release

Build renderer + main/preload first:

```bash
npm run build
```

#### macOS (macOS 12+)

```bash
npm run dist:mac
```

Artifacts will be in `release/` (`dmg` + `zip`).

#### Mac App Store (MAS) builds

MAS builds are **for App Store submission/testing flows**, not for normal local installation/distribution.

- `npm run dist:mas`: produces a `.pkg` intended to be uploaded via Transporter / App Store Connect.
  - If you double-click install this `.pkg` locally, macOS Gatekeeper may reject launching the app (common symptom: “应用程序无法打开”).
- For **local testing**, prefer `npm run dist:mas:dev` (`mas-dev` target), then run the generated `.app` directly (requires a valid **Apple Development** certificate in your Keychain).
- For **local distribution outside the App Store**, use the `dmg/zip` build (`npm run dist:mac`) and sign/notarize with a **Developer ID Application** certificate.

#### Windows (Win10/11)

```bash
npm run dist:win
```

Artifacts will be in `release/` (NSIS installer + portable exe).

### Auto update

- The app checks GitHub Releases in the background on startup, shows a **red dot** in the in-app menu when a new version is available, and installs the update after you click it.
- **Windows**: auto update works with the **NSIS installer** build (portable exe does **not** support auto update).
- **macOS**: auto update uses the `zip` artifact generated by electron-builder.
- Required release assets:
  - **macOS**: `latest-mac.yml` + `*.zip` (+ `*.blockmap`)
  - **Windows**: `latest.yml` + `*.exe` (+ `*.blockmap`)

#### Publishing to GitHub

Use `electron-builder --publish` so the required `latest-*.yml` files are uploaded automatically.

You must provide a GitHub token:

```bash
export GH_TOKEN="YOUR_GITHUB_PAT"
```

Recommended scripts (publish per-arch):

```bash
# macOS (Apple Silicon)
npm run dist:mac:apple:publish

# macOS (Intel)
npm run dist:mac:intel:publish

# Windows (run on Windows)
npm run dist:win:publish
```

### Notes

- **Build on the target OS**: build macOS apps on macOS, Windows apps on Windows (toolchains/signing/system components differ).
- This project ships **without code signing** by default (`dmg.sign=false`). For production releases, add certificates and signing.

### Screenshots

**Preview**

![Preview](docs/images/preview_1.jpg)

**Dark mode**

![Dark mode](docs/images/preview_2.jpg)

**Docked mode**

![Docked mode](docs/images/preview_3.jpg)

### Features (menu-level)

- **File**: New / Open (multi-select) / Save / Save As / Close Tab / Quit
- **Edit**: Undo/Redo, Cut/Copy/Paste, Select All, Find/Replace, Go to Line, Insert Date/Time
- **Format/View**: Word wrap, Font settings, Status bar toggle, Markdown edit/preview/split toggle
- **Encoding**: UTF-8 / UTF-16LE / GBK / GB18030 / ANSI (Win-1252)


